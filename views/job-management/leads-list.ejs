
<div class="page-content-wrapper">
    <div class="page-content">
        <div class="page-bar">
            <ul class="page-breadcrumb">
                <li><span><a href="/dashboard">Home</a></span><i class="fa fa-circle"></i></li>
                <li><span>Jobs</span><i class="fa fa-circle"></i></li>
                <li><span>Leads</span></li>
            </ul>
            <div class="page-toolbar">
                <div id="date-range" class="pull-right btn btn-sm">
                    <i class="icon-calendar"></i>&nbsp;
                    <span class="thin uppercase"></span>&nbsp;
                    <i class="fa fa-angle-down"></i>
                </div>
            </div>
        </div>
        <h1 class="page-title"></h1>
        <div class="row">
            <div class="col-md-12">
                <div id="form-alerts"> </div>
                <div class="portlet light bordered" id="leads_portlet">
                    <div class="portlet-title">
                        <div class="caption font-blue-hoki">
                            <i class="fa fa-bullhorn font-blue-hoki"></i>
                            <span class="caption-subject bold uppercase"> Leads </span>
                        </div>
                        <!-- <div class="dt-buttons pull-right">
                            
                            

                        </div> -->
                        <div class="btn-group pull-right">
                            <a class="btn sbold grey" href="/leads/csv?fromDate=<%= from %>&toDate=<%= to %>&q=<%= option %>" style="padding:6px 12px;margin-right:5px;"><span><i class="fa fa-download"></i> Download CSV</span></a>
                            <a class="btn sbold blue" data-toggle="modal" href="#bulkUpload" style="padding:6px 12px;margin-right:5px;"><span><i class="fa fa-upload"></i> Bulk Upload</span></a>
                            <a class="btn sbold green" href="/leads/add" style="padding:6px 12px;margin-right:5px;"><span><i class="icon-plus"></i> Add Lead</span></a>

                            <button data-toggle="dropdown" class="btn green btn-sm btn-outline btn-action dropdown-toggle hidden" type="button" aria-expanded="false" style="padding:6px 12px;margin-right:5px;"> Actions
                                <i class="fa fa-angle-down"></i>
                            </button>
                            <ul role="menu" class="dropdown-menu pull-right">
                                <li class="hidden" id="confirm">
                                    <a data-toggle="modal" href="#leadConfirmModal">
                                    <i class="icon-check"></i> Confirm</a>
                                </li>
                                <li id="complete">
                                    <a href="#">
                                    <i class="fa fa-thumbs-up"></i> Completed</a>
                                </li>
                                <li id="cancel"> 
                                    <a href="#">
                                    <i class="icon-close"></i> Cancel 
                                    </a>
                                </li>
                                <li id="delete">
                                    <a class="mt-sweetalert">
                                        <i class="icon-trash"></i> Delete</a>
                                </li>
                                <li class="hidden" id="edit">
                                    <a href="#">
                                        <i class="fa fa-edit"></i> Edit</a>
                                </li>
                                <li class="hidden" id="task">
                                    <a data-toggle="modal" href="#addTaskModal">
                                        <i class="fa fa-sticky-note"></i> Create Task</a>
                                </li>
                                <li class="hidden" id="transfer">
                                    <a data-toggle="modal" href="#leadAssignModal">
                                        <i class="icon-check"></i> Transfer</a>
                                </li>
                                <li class="hidden" id="quote">
                                    <a href="#">
                                        <i class="fa fa-book"></i> Send Quote</a>
                                </li>
                                
                                <li id="invoice"> 
                                    <a href="#">
                                        <i class="fa fa-files-o"></i> Invoice</a>
                                </li>

                                <li id="sendSms"> 
                                    <a href="#">
                                        <i class="icon-bubbles"></i> Send SmS</a>
                                </li>

                                <li class="hidden" id="inventory">
                                    <a data-toggle="modal" href="#assignProModal">
                                        <i class="icon-check"></i> Inventory</a>
                                </li>
                                <li class="hidden" id="feedback">
                                    <a data-toggle="modal" href="#content">
                                        <i class="icon-check"></i> Feedback</a>
                                </li>
                                <li class="hidden" id="payment">
                                    <a href="#">
                                        <i class="fa fa-inr"></i> Send Payment Link</a>
                                </li>
                            </ul>

                            <a class="dt-button buttons-csv buttons-html5 btn dark btn-outline fullscreen"><span><i class="icon-size-fullscreen"></i></span></a>
                        </div>
                    </div>
                    <div class="portlet-body">
                     <input type="hidden" id="total" value="<%= total %>" />
                     <input type="hidden" id="option" value="<%= option %>" />
                     <input type="hidden" id="from" value="<%= from %>"/>
                      <input type="hidden" id="to" value="<%= to %>"/>
                     <input type="hidden" id="pno" value="<%= pno %>" /> 
                     <input type="hidden" id="psize" value="<%= psize %>" /> 
                        <form class="search-form search-form-expanded">
                            <div class="input-group pull-right" style="width:20%;">
                                <input type="text" name="q" placeholder="Search..." class="form-control" id="query">
                                <span class="input-group-btn">
                                    <a class="btn submit" id="searched">
                                        <i class="icon-magnifier"></i>
                                    </a>
                                </span>
                            </div>
                        </form>
                        <br>

                        <div class="bootstrap-table">
                            <div class="fixed-table-toolbar">
                                <br>
                                <br>
                            </div>
                            <div class="fixed-table-container" style="height: 186px; padding-bottom: 41px;">
                                <div class="fixed-table-body" id="tDiv">
                                    <div class="fixed-table-loading" style="top: 42px; display: none;">Loading, please wait...
                                    </div>
                                    <table data-search="true" data-toggle="table" id="table-pagination" class= "table table-striped table-bordered table-hover table-checkable order-column" id="lead" style="margin-top: -41px;">
                                        <thead>
                                            <tr>
                                                <th tabindex="0" data-field="state" style="width: 36px; " class="table-checkbox">
                                               <!--  <input type="checkbox" class="group-checkable" data-set="#leads_list .checkboxes" />  -->
                                                       
                                                </th>            
                                                <th tabindex="0" data-field="id"><div class="th-inner sortable both">Date</div><div class="fht-cell"></div>
                                                </th>
                                                <th tabindex="0" data-field="name">
                                                    <div class="th-inner sortable both">Bill No</div>
                                                    <div class="fht-cell">
                                                        
                                                    </div>
                                                </th>
                                                <th tabindex="0" data-field="price" style="">
                                                    <div class="th-inner sortable both">Customer</div>
                                                    <div class="fht-cell">
                                                        
                                                    </div>
                                                </th>
                                                <th tabindex="0" data-field="price" style="">
                                                    <div class="th-inner sortable both">Mobile</div>
                                                    <div class="fht-cell">
                                                        
                                                    </div>
                                                </th>
                                                <th tabindex="0" data-field="price" style="">
                                                    <div class="th-inner sortable both">Service</div>
                                                    <div class="fht-cell">
                                                        
                                                    </div>
                                                </th>
                                                <th tabindex="0" data-field="price" style="">
                                                    <div class="th-inner sortable both">Job Date</div>
                                                    <div class="fht-cell">
                                                        
                                                    </div>
                                                </th>
                                                <th tabindex="0" data-field="price" style="">
                                                    <div class="th-inner sortable both">Price</div>
                                                    <div class="fht-cell">
                                                        
                                                    </div>
                                                </th>
                                                <th tabindex="0" data-field="price" style="">
                                                    <div class="th-inner sortable both">Assigned To</div>
                                                    <div class="fht-cell">
                                                        
                                                    </div>
                                                </th>
                                                <th tabindex="0" data-field="price" style="">
                                                    <div class="th-inner sortable both">Address</div>
                                                    <div class="fht-cell">
                                                        
                                                    </div>
                                                </th>
                                                <th tabindex="0" data-field="price" style="">
                                                    <div class="th-inner sortable both">Status</div>
                                                    <div class="fht-cell">
                                                        
                                                    </div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="tableData">
                                        <% if (data == undefined || data.length < 1){ %>
                                                
                                                <!-- formatVisitorStatus  to be fix -->
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td style="text-align: center;"> There is no leads  in your list</td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                            <%}else{ var style = '';for(var i=0; i < data.length; i++) { %>
                                                <% if(data[i].leadStatus === 'CONVERTED'){ %>
                                                    <% style = 'green'%>

                                               <% }else if(data[i].leadStatus === 'PAID'){ %>
                                                    <% style = '#28348c' %>

                                                <%}else if(data[i].leadStatus === 'TRANSFERRED'){%>
                                                    <% style = 'orange'%>

                                               <% }else if(data[i].leadStatus === 'CANCELLED'){%>
                                                    <% style = 'red'%>
                                                <% }else if(data[i].leadStatus === 'COMPLETED'){%>
                                                    <% style = '#03aace'%>
                                               <% }else { style = 'grey'} %>

                                                 <tr data-index=i style="background-color:<%= style %>;color:white;">
                                                    <label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">
                                                        <td><input type="checkbox" class="checkboxes" name="btSelectItem" data-index='+ i +'value="1" data-id="<%= data[i].id %>" data-name ="<%= data[i].customer != undefined ?  data[i].customer.name: ''%>" data-mobile="<%= data[i].customer != undefined ?  data[i].customer.mobile: ''%>" data-empid="<%= data[i].employee != undefined ?  data[i].employee.mobile: ''%>" data-eid="<%= data[i].employee != undefined ?  data[i].employee.id: ''%>" data-custmobile="<%= data[i].customer != undefined ?  data[i].customer.mobile: ''%>" data-customerName="<%= data[i].customer != undefined ?  data[i].customer.name: ''%>" data-custEmail="<%= data[i].customer != undefined ?  data[i].customer.email: ''%>" data-truLead="<%= data[i].leadId != undefined ?  data[i].leadId: ''%>" data-pid="<%= data[i].portId != undefined ?  data[i].portId: ''%>" data-aId="<%= data[i].aItemId != undefined ?  data[i].aItemId: ''%>" data-price="<%= data[i].price != undefined ?  data[i].price: 0%>" data-status="<%= data[i].leadStatus != undefined ?  data[i].leadStatus: ''%>" data-service="<%= data[i].item != undefined ?  data[i].item.name: ''%>" data-serviceId="<%= data[i].item != undefined ?  data[i].item.id: ''%>" data-jdate="<%= data[i].dueDate != undefined ? moment(new Date( data[i].dueDate)).format("DD-MMM-YYYY , h:mm a") : ''%>" data-address="<%= data[i].address != undefined ?  data[i].address: ''%>"/>
                                                        </td>
                                                        <span>
                                                        
                                                        </span>
                                                    </label>
                                                    <td class="clickable" onClick="document.location.href='/leads/<%= data[i].id%>';"> <%= data[i].createdOn != undefined ? moment(new Date( data[i].createdOn)).format("DD MMMM YYYY - HH:mm") : ''%> </td>
                                                    <td class="clickable" onClick="document.location.href='/leads/<%= data[i].id%>';"> <%= data[i].leadId != undefined ?  data[i].leadId: ''%> </td>
                                                    <td class="clickable" onClick="document.location.href='/leads/<%= data[i].id%>';"> <%= data[i].customer != undefined ?  data[i].customer.name: ''%>  </td>
                                                    <td class="clickable" onClick="document.location.href='/leads/<%= data[i].id%>';"> <%= data[i].customer != undefined ?  data[i].customer.mobile: ''%> </td>
                                                    <td class="clickable" onClick="document.location.href='/leads/<%= data[i].id%>';"> <%= data[i].item != undefined ?  data[i].item.name: ''%>  </td>
                                                    <td class="clickable" onClick="document.location.href='/leads/<%= data[i].id%>';"> <%= data[i].dueDate != undefined ? moment(new Date( data[i].dueDate)).format("DD MMMM YYYY - HH:mm") : ''%> </td>
                                                    <td class="clickable" onClick="document.location.href='/leads/<%= data[i].id%>';">  <%= data[i].price != undefined ?  data[i].price: '0'%> </td>
                                                    <td class="clickable" onClick="document.location.href='/leads/<%= data[i].id%>';"> <%= (data[i].employee != undefined ? ''+data[i].employee.name + '('+ data[i].employee.mobile + ')'  : '')%>  </td>

                                                    <td class="clickable" onClick="document.location.href='/leads/<%= data[i].id%>';">  <%= data[i].address != undefined ?  data[i].address: ''%> </td>  
                                                    <td class="clickable" onClick="document.location.href='/leads/<%= data[i].id%>';">  <%= data[i].leadStatus != undefined ?  data[i].leadStatus: ''%> </td>   
                                                </tr></a>
                                       <% }}%>
                                        
                                        </tbody>
                                    </table>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <% if (data != undefined || data.length > 0){ %>
                                            <div class="pull-left pagination-detail">
                                                
                                                <% if(pno === 1){ var from1 = 1; var to1 = data.length%>

                                                <%}else{ var from1 = (((pno* psize)+1)-psize); var to1 = from1 + data.length -1 %>
                                                <% } %>
                                                <span class="pagination-info">Showing <%= from1 %>  to <%= to1 %>  of <%=total %> rows
                                                </span>
                                                <% var url = '/leads?pno=1&psize=10'; if(from !=''){ url =url+'&fromDate='+from+'&toDate='+to } if(option !=''){ url = url+'&q='+option} %>

                                                <% var url1 = '/leads?pno=1&psize=25'; if(from !=''){ url1 =url1+'&fromDate='+from+'&toDate='+to } if(option !=''){ url1 = url1+'&q='+option} %>

                                                <% var url2 = '/leads?pno=1&psize=50'; if(from !=''){ url2 =url2+'&fromDate='+from+'&toDate='+to } if(option !=''){ url2 = url2+'&q='+option} %>

                                                <% var url3 = '/leads?pno=1&psize=100'; if(from !=''){ url3 =url3+'&fromDate='+from+'&toDate='+to } if(option !=''){ url3 = url3+'&q='+option} %>

                                                <span class="page-list">
                                                    <span class="btn-group dropup">
                                                        <button data-toggle="dropdown" class="btn btn-default  dropdown-toggle" type="button">
                                                            <span class="page-size">
                                                            </span> 
                                                            <span class="caret">
                                                            </span>
                                                        </button>
                                                        <ul role="menu" class="dropdown-menu">
                                                            <li><a href="<%= url %>">10</a>
                                                            </li>
                                                            <li><a href="<%= url1 %>">25</a>
                                                            </li>
                                                            <li><a href="<%= url2 %>">50</a>
                                                            </li>
                                                            <li><a href="<%= url3 %>">100</a>
                                                            </li>
                                                        </ul>
                                                    </span> records per page 
                                                </span>
                                            </div>
                                        <% }%>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="col-md-12 text-right">
                                            <ul class="pagination">
                                                <!-- 
                                                <li><a href="#">«</a></li>
                                                <li class="active"><a href="#">1</a></li>
                                                <li><a href="#">2</a></li>
                                                <li><a href="#">3</a></li>
                                                <li><a href="#">4</a></li>
                                                <li><a href="#">5</a></li>
                                                <li><a href="#">»</a></li>
                                                -->
                                            </ul>
                                        </div>
                                    </div>  
                                </div>
                            </div>
                        </div>
                        <div class="clearfix">
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" value="" id="smsMessage"/>
<input type="hidden" value="" id="smsMobile"/>

<input type="hidden" id="apiUrl" value="<%= api.url %>"/>
<input type="hidden" id="role" value="<%= user.profile.roles.indexOf('aggregator') %>"/>
<input type="hidden" id="token" value="<%= user.token %>"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.debug.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jsPDF/plugins/from_html.js"></script> -->
<%- partial('partials/modal/leadConfirm') %>
<%- partial('partials/modal/bulk') %>
<%- partial('partials/modal/assignTo') %>
<%- partial('partials/modal/assignLead') %>
<%- partial('partials/modal/feedback') %>
<%- partial('partials/modal/assignPro') %>
<%- partial('partials/modal/addTaskModel') %>